@model Entities.Timesheet_Request_Form

@{
    /**/

    Layout = "~/Views/Shared/_Layout.cshtml";
    var rolepages = TempData["RolePages"].ToString();
    ViewBag.RolePages = TempData["RolePages"];
}

@{
    var message = TempData["AlertMessage"] ?? string.Empty;
}
@{
    var message1 = TempData["cancel"] ?? string.Empty;
}
@{
    var message2 = TempData["Approve"] ?? string.Empty;
}
@{
    var message3 = TempData["Denied"] ?? string.Empty;
}
<script type="text/javascript">
    var message = '@message';
    if (message) alert(message);

</script>
<!-- Include XLSX and FileSaver (local) -->
<script src="~/Assets/libs/excel/cdn_excel_0.17.js"></script>
<script src="~/Assets/libs/excel/cdn_excel_filesaver_v_2.0.js"></script>

<script type="text/javascript">
    function parseDate(dateString) {
        if (!dateString) { return null; }
        var match = /\/Date\((\d+)\)\//.exec(dateString);
        if (match && match[1]) {
            var ts = parseInt(match[1], 10);
            if (!isNaN(ts)) { return new Date(ts); }
        }
        var dt2 = new Date(dateString);
        if (!isNaN(dt2.getTime())) { return dt2; }
        return null;
    }
    function formatDate(date) {
        if (!date || isNaN(date.getTime())) return '';
        var d = date.getDate();
        var m = date.getMonth() + 1;
        var y = date.getFullYear();
        var dd = d < 10 ? ('0' + d) : ('' + d);
        var mm = m < 10 ? ('0' + m) : ('' + m);
        return dd + '/' + mm + '/' + y;
    }
    function s2ab(s) {
        var buf = new ArrayBuffer(s.length);
        var view = new Uint8Array(buf);
        for (var i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
        return buf;
    }
</script>
<style>
    .activeClass {
        background: #ffdb99;
    }

    .secondClass {
        /*background: #FF9999;*/
        color: red;
    }
</style>
<div class="container">
    <div class="panel with-nav-tabs panel-primary">
        <div class="panel-heading">
            @{
                <ul class="nav nav-tabs">
                    @if (rolepages.Contains("ADERG"))
                    {
                        <li><a href=@Url.Action("InsertEmployees", "Register")>Employee Registration</a></li>
                    }
                    @if (rolepages.Contains("ADTPO"))
                    {
                        <li><a href="@Url.Action("Index","Transfer")">Transfer/Promotions</a></li>
                    }
                    @if (rolepages.Contains("ADCAU"))
                    {
                        <li><a href="@Url.Action("Index","ChangeAuthority")">Change Authority</a></li>
                    }
                    @if (rolepages.Contains("ADCPR"))
                    {
                        <li><a href="@Url.Action("Index","ChangeProfile")">Change Profile</a></li>
                    }
                    @if (rolepages.Contains("ADLTCA"))
                    {
                        <li><a href=@Url.Action("AdminLTCApply", "LeaveTravel")>Apply LTC </a></li>
                    }

                    @if (rolepages.Contains("ADPLA"))
                    {
                        <li><a href=@Url.Action("AdminPLApply", "PLE_Type")>Apply PL Encashment</a></li>
                    }
                    @if (rolepages.Contains("ADWDA"))
                    {
                        <li><a href=@Url.Action("WorkApprovalAdmin", "WorkDiary")>Delete Work Dairy</a></li>
                    }
                    @if (rolepages.Contains("ADUSRO"))
                    {
                        <li><a href=@Url.Action("UserRolesView", "AllReports")>User Roles</a></li>
                    }
                    @if (rolepages.Contains("ADCBRMG"))
                    {
                        <li><a href=@Url.Action("ChangeBranchManager", "ChangeBranchManager")>Change Branch Manager</a></li>
                    }
                    @if (rolepages.Contains("TsheetMain"))
                    {
                        <li><a href=@Url.Action("Timesheetrequestform", "TimeSheet")>TimeSheet Manual Form</a></li>
                    }
                    @if (rolepages.Contains("TsheetApp"))
                    {
                        <li class="active"><a href=@Url.Action("TSApprovalView", "TimeSheet")>TimeSheet Manual Approvals</a></li>
                    }
                </ul>
            }
        </div>
        <div class="panel-body">
            <div class="tab-content">
                <div class="tab-pane fade  in active" id="tab2primary">
                    <div class="page_st">
                        <div class="page">
                            <div class="col-md-12 col-sm-12">
                                <div class="main_heading">
                                    <h1>Timesheet Manual Approvals </h1>
                                    <div class="col-md-12">
                                        <div class="form-horizontal">
                                            <div class="col-md-4 col-sm-3 col-xs-12">
                                                <div class="form-group">
                                                    <label class="col-sm-5 control-label label_left">Request From Date:<span class="mandatory">*</span></label>
                                                    <div class="input-group date col-sm-6">
                                                        <input type="text" id="SDate" class="form-control" onkeypress="return nokeyword(event)" , onchange="return Dateevent4();"><span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-sm-3 col-xs-12">
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">Request To Date:<span class="mandatory">*</span></label>
                                                    <div class="input-group date col-sm-6">
                                                        <input type="text" id="EDate" class="form-control" onkeypress="return nokeyword(event)" , onchange="return Dateevent2();"><span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-sm-3 col-xs-12">
                                                <div class="form-group">
                                                    <label class="col-sm-3 control-label">Status:</label>
                                                    <div class="col-sm-6">
                                                        @Html.DropDownList("Status", new[] {
                                                                                                 new SelectListItem() {Text = "All",Value = "All"},
                                                                                                                 new SelectListItem() {Text = "Pending",Value = "Pending"},
                                                                                                                 //new SelectListItem() {Text = "Forwarded",Value = "Forwarded"},
                                                                                                                  new SelectListItem() {Text = "Approved",Value = "Approved"},
                                                                                                                  new SelectListItem() {Text = "Denied",Value = "Denied"},

                                                                                                                   new SelectListItem() {Text = "Cancelled",Value = "Cancelled" },

                                                                                      }, "Select", new { @class = "form-control", @id = "Status" })
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <button type="button" onclick="return TimesheetApproval();" id="btnApply" class="btn btn-primary btn-sm pull-right">Search</button>

                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <div id="myModal" class="modal" style="z-index: 9999999999;">

                                            <!-- Modal content -->
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="submit" id="btnclosepop" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                    <h4 class="modal-title">OD Approval</h4>
                                                </div>

                                                <table id="myTextArea" style="margin: 25px auto;width: 92%;"></table>

                                                <div class="modal-footer">
                                                    <button type="submit" id="btnPreviouspopup" class="btn btn-default leaveprev">Previous</button>
                                                    <button type="submit" id="btnDenyApprovalpopup" class="btn btn-default leaveDeny">Deny</button>
                                                    <button style="margin: 0 6px 0 6px;" type="submit" id="btnApprovalspopup" class="btn btn-primary leaveapprove">Approve</button>
                                                    <button type="submit" id="btncancelApprovalpopup" class="btn btn-danger leavecancel">Cancel</button>
                                                    <button type="submit" id="btnNextpopup" class="btn btn-default leavenext">Next</button>
                                                </div>
                                            </div>

                                        </div>


                                        <div id="grid"></div>

                                    </div>
                                    <div class="col-md-12">
                                        <div class="col-md-12">
                                            <div class="export_btn m_15">
                                                <input type="button" class="btn btn-info" value="Export to Excel" id='excelExport' />
                                            </div>

                                            <div class="buttons_div m_15">
                                                <div class="pull-right">
                                                    <button type="submit" id="btnDenyApproval" class="btn btn-default leaveDeny">Deny</button>
                                                    <button style="margin: 0 6px 0 6px;" type="submit" id="btnApprovals" class="btn btn-primary leaveapprove">Approve</button>
                                                    <button type="submit" id="btncancelApproval" class="btn btn-danger leavecancel">Cancel</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="pagenation" style="visibility:hidden"></div>
<input id="currentpos" type="hidden" />
<script>
    // Get the modal
    var modal = document.getElementById('myModal');

</script>


<style>
    .modal-content2 {
        width: 100% !important;
        left: 0px !important;
        background: #fff !important;
    }

    .modal-open .modal {
        overflow-x: hidden;
        overflow-y: auto;
        z-index: 99999 !important;
    }
    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
        margin: auto;
        padding: 0px;
        border: 1px solid rgb(136, 136, 136);
        width: 50%;
        z-index: 99999999999;
        left: 25%;
        background: rgb(219, 238, 247);
    }

    /* The Close Button */
    .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

    .modal-header {
        min-height: 16.42857143px;
        padding: 13px;
        border-bottom: 1px solid rgb(221, 221, 221);
        background: rgba(60, 141, 188, 0.4);
    }

        .modal-header h4 {
            font-size: 18px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgb(255, 255, 255);
        }

    #myTextArea td {
        border: 1px solid #c2c2c2;
        padding: 3px 5px 3px 5px;
    }

    .modal-header .close {
        margin-top: -2px;
        color: rgb(0, 0, 0);
        opacity: 4;
        /* background: rgb(0, 0, 0); */
    }
</style>
<script type="text/javascript">
    var screenTheme = 'darkblue';
    var popupTheme = 'highcontrast';
    var otherTheme = 'arctic';

    var localizationObject = {
        filterstringcomparisonoperators: ['contains', 'does not contain'],  /* filter String Comparison Operators    */
        filternumericcomparisonoperators: ['less than', 'greater than'],    /* filter Numeric Comparison Operators  */
        filterdatecomparisonoperators: ['less than', 'greater than'],       /* filter Date comparison operators.  */
        filterbooleancomparisonoperators: ['equal', 'not equal']            /* filter bool comparison operators.*/
    };
    var stringcomparisonoperators = ['CONTAINS', 'DOES_NOT_CONTAIN'];
    var numericcomparisonoperators = ['LESS_THAN', 'GREATER_THAN'];
    var datecomparisonoperators = ['LESS_THAN', 'GREATER_THAN'];
    var booleancomparisonoperators = ['EQUAL', 'NOT_EQUAL'];

    $(document).ready(function () {
        debugger;

        // $("#grid").jqxGrid('selectrow', 0);
        // $("#grid").jqxGrid('selectrow', 1);
        var theme = otherTheme;
        // prepare the data
        var url = "../TimeSheet/TSApprovalViews";
        var source =
        {
            type: "Get",
            datatype: "json",
            datafields: [
                { name: 'available', type: 'bool' },
                { name: 'Id', type: 'int' },
                { name: 'EmpId', type: 'string' },
                { name: 'EmployeeName', type: 'string' },

                { name: 'Deptbranch', type: 'string' },
                // { name: 'Reason_Desc', type: 'string' },
                { name: 'designation', type: 'string' },
                { name: 'ReqFromDate', type: 'date' },
                { name: 'AppliedDate', type: 'date' },
                { name: 'entrytime', type: 'string' },
                { name: 'exittime', type: 'string' },
                { name: 'Reason_Type', type: 'string' },

                { name: 'Status', type: 'string' },

            ],
            async: false,
            url: url,

            data: {
                featureClass: "P",
                style: "full",
                username: "jqwidgets"
            }
        };
        var cellsrenderer = function (row, columnfield, value, defaulthtml, columnproperties, rowdata) {
            if (value == "Pending") {
                return '<span style="margin: 4px; float: ' + columnproperties.cellsalign + '; color: #FFA500;">' + value + '</span>';
            }
            else if (value == "Forwarded") {
                return '<span style="margin: 4px; float: ' + columnproperties.cellsalign + '; color: #33b5e5;">' + value + '</span>';
            }
            else if (value == "Approved") {
                return '<span style="margin: 4px; float: ' + columnproperties.cellsalign + '; color: #00C851;">' + value + '</span>';
            }
            else if (value == "Denied") {
                return '<span style="margin: 4px; float: ' + columnproperties.cellsalign + '; color: #8B008B;">' + value + '</span>';
            }
            else {
                return '<span style="margin: 4px; float: ' + columnproperties.cellsalign + '; color: #ff4444;">' + value + '</span>';
            }
        }
        var dataAdapter = new $.jqx.dataAdapter(source,
            {
                formatData: function (data) {
                    data.ProductName = $("#searchField").val();
                    return data;
                }
            }
        );
        // initialize jqxGrid
        var editrowindex = -1;
        var delrowindex = -1;
        $("#grid").jqxGrid(
            {
                width: '100%',
                source: dataAdapter,
                theme: otherTheme,// for theme refernce go to Layout.cshtml
                autoheight: true,
                sortable: true,
                pageable: true,
                columnsResize: true,
                altRows: true,
                filterable: true,
                autoshowfiltericon: true,
                editable: true,
                selectionmode: 'multiplerows',

                ready: function () {
                    $("#grid").jqxGrid('localizestrings', localizationObject);
                },
                //selectionmode: 'checkbox',
                //altrows: true,
                updatefilterconditions: function (type, defaultconditions) {
                    switch (type) {
                        case 'stringfilter':
                            return stringcomparisonoperators;
                        case 'numericfilter':
                            return numericcomparisonoperators;
                        case 'datefilter':
                            return datecomparisonoperators;
                        case 'booleanfilter':
                            return booleancomparisonoperators;
                    }
                },
                updatefilterpanel: function (filtertypedropdown1, filtertypedropdown2, filteroperatordropdown, filterinputfield1, filterinputfield2,
                    filterbutton, clearbutton, columnfilter, filtertype, filterconditions) {
                    var index1 = 0;
                    var index2 = 0;
                    if (columnfilter != null) {
                        var filter1 = columnfilter.getfilterat(0);
                        var filter2 = columnfilter.getfilterat(1);
                        if (filter1) {
                            index1 = filterconditions.indexOf(filter1.comparisonoperator);
                            var value1 = filter1.filtervalue;
                            filterinputfield1.val(value1);
                        }
                        if (filter2) {
                            index2 = filterconditions.indexOf(filter2.comparisonoperator);
                            var value2 = filter2.filtervalue;
                            filterinputfield2.val(value2);
                        }
                    }
                    filtertypedropdown1.jqxDropDownList({ autoDropDownHeight: true, selectedIndex: index1 });
                    filtertypedropdown2.jqxDropDownList({ autoDropDownHeight: true, selectedIndex: index2 });
                },
                columns: [

                    {
                        text: '', menu: false, sortable: false,
                        datafield: 'available', columntype: 'checkbox', width: 40,
                        renderer: function () {
                            return '<div style="margin-left: 10px; margin-top: 5px;"></div>';
                        },
                        rendered: function (element) {
                            debugger;
                            $(element).jqxCheckBox({ theme: theme, width: 16, height: 16, animationShowDelay: 0, animationHideDelay: 0 });
                            columnCheckBox = $(element);
                            $(element).on('change', function (event) {
                                var checked = event.args.checked;
                                var pageinfo = $("#grid").jqxGrid('getpaginginformation');
                                var pagenum = pageinfo.pagenum;
                                var pagesize = pageinfo.pagesize;
                                //if (checked == null || updatingCheckState) return;
                                //$("#gridControlling").jqxGrid('beginupdate');

                                // select all rows when the column's checkbox is checked.
                                if (checked == true) {
                                    $("#grid").jqxGrid('selectallrows');
                                }
                                // unselect all rows when the column's checkbox is checked.
                                else if (checked == false) {
                                    $("#grid").jqxGrid('clearselection');
                                }

                                // update cells values.
                                var startrow = pagenum * pagesize;
                                for (var i = startrow; i < startrow + pagesize; i++) {
                                    // The bound index represents the row's unique index.
                                    // Ex: If you have rows A, B and C with bound indexes 0, 1 and 2, afer sorting, the Grid will display C, B, A i.e the C's bound index will be 2, but its visible index will be 0.
                                    // The code below gets the bound index of the displayed row and updates the value of the row's available column.
                                    var boundindex = $("#grid").jqxGrid('getrowboundindex', i);
                                    $("#grid").jqxGrid('setcellvalue', boundindex, 'available', event.args.checked);
                                }

                                $("#grid").jqxGrid('endupdate');
                            });
                            return true;
                        }
                    },
                    { text: 'Id', groupable: true, datafield: 'Id', editable: false, width: 90, hidden: true, sortable: false },
                    { text: "Emp Code", datafield: "EmpId", width: 80, sortable: false, editable: false },
                    { text: "Employee Name", datafield: "EmployeeName", width: 127, sortable: false, editable: false },
                    { text: "Branch/Department", datafield: "Deptbranch", editable: false, width: 120, sortable: false },
                    { text: 'Designation', editable: false, datafield: 'designation', align: 'center', width: 130, sortable: false },

                    { text: 'Request Date', editable: false, datafield: 'ReqFromDate', align: 'center', width: 100, cellsformat: 'dd/MM/yyyy', sortable: false },
                    { text: 'Applied Date', editable: false, datafield: 'AppliedDate', align: 'center', width: 100, cellsformat: 'dd/MM/yyyy', sortable: false },

                    //{ text: 'Description', editable: false, datafield: 'Reason_Desc', align: 'center', width: 270, sortable: false },
                    { text: 'Entry Time', datafield: 'entrytime', width: 80, sortable: false, cellsformat: 't', editable: false },
                    { text: 'Exit Time', datafield: 'exittime', width: 80, sortable: false, cellsformat: 't', editable: false },
                    { text: 'Reason Type', editable: false, datafield: 'Reason_Type', align: 'center', width: 150, sortable: false },

                    { text: 'Status', editable: false, cellsrenderer: cellsrenderer, datafield: 'Status', align: 'center', width: 70, sortable: false },



                ],
                columngroups:
                    [
                        { text: 'Action', align: 'center', name: 'Actions', width: 120 },
                    ],
            });


        $("#grid").on("rowselect", function (event) {

            var rowindex = $('#grid').jqxGrid('getselectedrowindex');
            // var selectedrowindex = $(“#admission_grid_fees”).jqxGrid(‘getselectedrowindex’);
            var args = event.args;
            var row = args.rowindex;
            var rows = $('#grid').jqxGrid('getrows');
            var rowlength = $('#grid').jqxGrid('getrows').length;
            if (rowlength <= 1) {
                document.getElementById('btnPreviouspopup').style.display = 'none';
                document.getElementById('btnNextpopup').style.display = 'none';
            }
            //console.log(rows[row].Id);
            if (rows[row] == undefined) {

                for (var p = 0; p < rows.length; p++) {

                    if (parseInt(rows[p].dataindex) == parseInt(row)) {

                        value = rows[p].Id;
                        row = p;

                    }
                }
            }
            else {
                var filter = $("#grid").jqxGrid('getfilterinformation');
                if (filter.length == 0) {
                    var value = rows[row].Id;
                }
                else {
                    for (var p = 0; p < rows.length; p++) {

                        if (parseInt(rows[p].dataindex) == parseInt(row)) {

                            value = rows[p].Id;
                            row = p;

                        }
                    }
                }

            }

            document.getElementById("currentpos").value = row;
            var string = "";
            for (var i = 0; i < rows.length; i++) {
                string += "<input type='text' id='" + i + "' value='" + rows[i].Id + "'/>";
            }
            document.getElementById("pagenation").innerHTML = string;
            $('.leavenext').attr("disabled", false);
            $('.leaveprev').attr("disabled", false);
            $.ajax({
                url: "/Timesheet/ODTooltip?EmployeeCodey=" + value,
                Type: 'Get',
                dataType: 'json',
                success: function (response) {

                    if (response != null) {

                        if (!rows[row].available) {

                            modal.style.display = "block";
                        }

                        //var dateString = response..substr(6);
                        //var currentTime = new Date(parseInt(dateString));
                        //var month = currentTime.getMonth() + 1;
                        //var day = currentTime.getDate();
                        //var year = currentTime.getFullYear();
                        //var sdate = day + "-" + month + "-" + year;
                        //var dateString1 = response.lenddate.substr(6);
                        //var currentTime1 = new Date(parseInt(dateString1));
                        //var month1 = currentTime1.getMonth() + 1;
                        //var day1 = currentTime1.getDate();
                        //var year1 = currentTime1.getFullYear();
                        //var edate = day1 + "-" + month1 + "-" + year1;
                        var text =
                            "<tr><td>EmployeeCode:</td><td>" + " " + " " + response.lEmployeeId
                            + "</td></tr> <tr><td> EmployeeName:</td><td>" + " " + " " + response.lEmployeeName
                            + "</td></tr> <tr><td> Branch/Dept:</td><td>" + " " + " " + response.lDeptbranch
                            + "</td></tr><tr><td>  Status:</td><td>" + " " + " " + response.lStatus + "</td></tr>"
                            + "</td></tr><tr><td> Applied Date:</td><td>" + " " + " " + response.lAppliedDate + "</td></tr>"
                            + "</td></tr><tr><td> Entry Time:</td><td>" + " " + " " + response.lentrytime + "</td></tr>"
                            + "</td></tr><tr><td> Exit Time:</td><td>" + " " + " " + response.lexittime + "</td></tr>"
                            + "</td></tr><tr><td> Request Date:</td><td>" + " " + " " + response.lReqFromDate + "</td></tr>"
                            + "</td></tr><tr><td> Reason Type:</td><td>" + " " + " " + response.lReason_Type + "</td></tr>"
                        //  + "</td></tr><tr><td> Description:</td><td>" + " " + " " + response.lReason_Desc + "</td></tr>" ;


                        document.getElementById("myTextArea").innerHTML = text;

                    }

                },
            });

        });


        $("#grid").bind('cellendedit', function (event) {
            if (event.args.value) {
                $("#grid").jqxGrid('selectrow', event.args.rowindex);


            }
            else {
                $("#grid").jqxGrid('unselectrow', event.args.rowindex);
            }
        });
        $("#btnDenyApproval").click(function () {

            var rows = $("#grid").jqxGrid('selectedrowindexes');
            var row = $("#grid").jqxGrid('getrowdata', rows[m]);
            var myArray = new Array();
            var names = '';
            var types = '';
            var ids = '';
            for (var m = 0; m < rows.length; m++) {
                myArray[myArray.length] = rows;
                var row = $("#grid").jqxGrid('getrowdata', rows[m]);
                names = names + row.EmpId + ',';
                types = types + row.Code + ',';
                ids = ids + row.Id + ',';
            }


            if (rows == '' || rows == null) {
                alert("Please select checkbox");
                return false;
            }
            else {
                $('.leaveDeny').attr("disabled", true);
                $.ajax({
                    type: "Post",
                    url: "/TimeSheet/Deny?EmployeeCodey=" + names + "&leaveTypes=" + types + "&LeaveIds=" + ids,
                    dataType: "Json",
                    success: function (response) {
                        if (response != null) {
                            window.location.reload();

                        }
                        else {
                            // alert("Something went wrong");
                        }
                    },
                });

            }

        });

        $("#btnclosepop").click(function () {
            modal.style.display = "none";
            document.getElementById("pagenation").innerHTML = '';
        });


        $("#btnApprovals").click(function () {
            var rows = $("#grid").jqxGrid('selectedrowindexes');
            //var row = $("#grid").jqxGrid('getrowdata', rows[m]);
            var myArray = new Array();
            var names = '';
            var types = '';
            var ids = '';
            //for (var m = 0; m < rows.length; m++) {
            //    myArray[myArray.length] = rows;
            //    var row = $("#grid").jqxGrid('getrowdata', rows[m]);
            //    names = names + row.EmpId + ',';
            //    types = types + row.Code + ',';
            //    ids = ids + row.Id + ',';
            //}


            //if (rows == '' || rows == null) {
            //    alert("Please select checkbox");
            //    return false;
            //}
            //
            var allRows = $("#grid").jqxGrid('getrows');
            for (var i = 0; i < allRows.length; i++) {
                if (allRows[i].available == true) {
                    myArray[myArray.length] = allRows
                    names = names + allRows[i].EmpId + ',';
                    types = types + allRows[i].Code + ',';
                    ids = ids + allRows[i].Id + ',';
                }
            };
            if (myArray == '' || myArray == null) {
                alert("Please select checkbox");
                //window.location.reload();
            }



            else {
                $('.leaveapprove').attr("disabled", true);
                $.ajax({
                    type: "Post",
                    url: "/TimeSheet/Approve?EmployeeCodey=" + names + "&LeaveIds=" + ids,
                    dataType: "Json",
                    success: function (response) {
                        if (response != null) {
                            window.location.reload();

                        }
                        else {


                        }
                    },
                });

            }

        });
        $("#btncancelApproval").click(function () {
            var rows = $("#grid").jqxGrid('selectedrowindexes');
            var row = $("#grid").jqxGrid('getrowdata', rows[m]);
            var myArray = new Array();
            var names = '';
            var types = '';
            var ids = '';
            for (var m = 0; m < rows.length; m++) {
                myArray[myArray.length] = rows;
                var row = $("#grid").jqxGrid('getrowdata', rows[m]);
                names = names + row.EmpId + ',';
                types = types + row.Code + ',';
                ids = ids + row.Id + ',';
            }


            if (rows == '' || rows == null) {
                alert("Please select checkbox");
                return false;
            }
            else {
                $('.leavecancel').attr("disabled", true);
                $.ajax({
                    type: "Post",
                    url: "/TimeSheet/Cancel?EmployeeCodey=" + names + "&LeaveIds=" + ids,
                    dataType: "Json",
                    success: function (response) {
                        if (response != null) {
                            window.location.reload();

                        }
                        else {
                            // alert("Something went wrong");
                        }
                    },
                });

            }
        });
        $("#excelExport").click(function () {
            var rows = $("#grid").jqxGrid('getrows') || [];
            var processed = [];
            for (var i = 0; i < rows.length; i++) {
                var it = rows[i] || {};
                var r = {};
                r.EmpId = it.EmpId || '';
                r.EmployeeName = it.EmployeeName || '';
                r.Deptbranch = it.Deptbranch || '';
                r.designation = it.designation || '';
                r.ReqFromDate = it.ReqFromDate ? formatDate(parseDate(it.ReqFromDate)) : '';
                r.AppliedDate = it.AppliedDate ? formatDate(parseDate(it.AppliedDate)) : '';
                r.entrytime = it.entrytime || '';
                r.exittime = it.exittime || '';
                r.Reason_Type = it.Reason_Type || '';
                r.Status = it.Status || '';
                processed.push(r);
            }

            var wb = XLSX.utils.book_new();
            var ws;
            if (processed.length > 0) {
                ws = XLSX.utils.json_to_sheet(processed);
            } else {
                try {
                    var cols = $("#grid").jqxGrid('columns');
                    var recs = cols ? cols.records || [] : [];
                    var headers = [];
                    for (var c = 0; c < recs.length; c++) {
                        if (recs[c] && recs[c].text && recs[c].datafield !== '') { headers.push(recs[c].text); }
                    }
                    ws = XLSX.utils.aoa_to_sheet([headers]);
                } catch (e) { ws = XLSX.utils.aoa_to_sheet([[]]); }
            }

            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
            var wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'binary' });
            var blob = new Blob([s2ab(wbout)], { type: 'application/octet-stream' });
            saveAs(blob, 'TimeSheetApprovals.xlsx');
            return false;
        });
    });

    $("#btnApprovalspopup").click(function () {
        var rows = $("#grid").jqxGrid('selectedrowindexes');
        var lval = document.getElementById("currentpos").value;
        if (rows == '' || rows == null) {
            alert("Please select checkbox");
            //window.location.reload();
        }
        else {

            var selectedRecords = new Array();
            var names = '';
            var types = '';
            var ids = '';
            //for (var m = 0; m < rows.length; m++) {
            var row = $("#grid").jqxGrid('getrowdata', lval);
            selectedRecords[selectedRecords.length] = row;
            if (row == undefined) {
                window.alert("There is no Data. Please Click on Previous button to get Data.");
            }
            else {
                names = names + row.EmpId + ',';
                types = types + row.Code + ',';
                ids = ids + row.Id + ',';
                $('.leaveapprove').attr("disabled", true);

                //}
                $.ajax({
                    type: "Post",
                    url: "/TimeSheet/Approve?EmployeeCodey=" + names + "&LeaveIds=" + ids,
                    dataType: "Json",
                    success: function (response) {
                        if (response != null) {
                            window.location.reload();

                        }
                        else {
                            // alert("Something went wrong");
                        }
                    },
                });
            }
        }
    });

    $("#btnPreviouspopup").click(function () {

        var rows = $('#grid').jqxGrid('getrows');
        var prev;
        var lss;
        var lval = document.getElementById("currentpos").value - 1;
        if (lval < rows) {
            lss = 0;
        }
        else {
            lss = 1;
        }
        prev = parseInt(document.getElementById("currentpos").value) - parseInt(lss);
        document.getElementById("currentpos").value = prev;
        var lcount = rows.length;
        if (prev == -1) {
            document.getElementById("currentpos").value = 0;
            $('.leaveprev').attr("disabled", true);
        }
        else if (prev < lcount) {
            $('.leavenext').attr("disabled", false);
            var ss = document.getElementById(prev).value;
            var value = ss;
            $.ajax({
                url: "/Timesheet/ODPrevioustip?EmployeeCodey=" + value,
                Type: 'Get',
                dataType: 'json',
                success: function (response) {
                    if (response != null) {
                        //var dateString = response.lstartdate.substr(6);
                        //var currentTime = new Date(parseInt(dateString));
                        //var month = currentTime.getMonth() + 1;
                        //var day = currentTime.getDate();
                        //var year = currentTime.getFullYear();
                        //var sdate = day + "-" + month + "-" + year;
                        //var dateString1 = response.lenddate.substr(6);
                        //var currentTime1 = new Date(parseInt(dateString1));
                        //var month1 = currentTime1.getMonth() + 1;
                        //var day1 = currentTime1.getDate();
                        //var year1 = currentTime1.getFullYear();
                        //var edate = day1 + "-" + month1 + "-" + year1;
                        var text =
                            "<tr><td>EmployeeCode:</td><td>" + " " + " " + response.lEmployeeId
                            + "</td></tr> <tr><td> EmployeeName:</td><td>" + " " + " " + response.lEmployeeName
                            + "</td></tr> <tr><td> Branch/Dept:</td><td>" + " " + " " + response.lDeptbranch
                            + "</td></tr><tr><td>  Status:</td><td>" + " " + " " + response.lStatus + "</td></tr>"
                            + "</td></tr><tr><td> Applied Date:</td><td>" + " " + " " + response.lAppliedDate + "</td></tr>"
                            + "</td></tr><tr><td> Entry Time:</td><td>" + " " + " " + response.lentrytime + "</td></tr>"
                            + "</td></tr><tr><td> Exit Time:</td><td>" + " " + " " + response.lexittime + "</td></tr>"
                            + "</td></tr><tr><td> Request Date:</td><td>" + " " + " " + response.lReqFromDate + "</td></tr>"
                            + "</td></tr><tr><td> Reason Type:</td><td>" + " " + " " + response.lReason_Type + "</td></tr>"
                        // + "</td></tr><tr><td> Description:</td><td>" + " " + " " + response.lReason_Desc + "</td></tr>";
                        document.getElementById("myTextArea").innerHTML = text;
                    }

                },
            });
        }
        else {
            $('.leaveprev').attr("disabled", true);
        }
    });



    $("#btnNextpopup").click(function () {
        var rows = $('#grid').jqxGrid('getrows');
        var prev;
        var lss;
        var lval = document.getElementById("currentpos").value;
        if (lval < rows) {
            lss = 1;
        }
        else {
            lss = 0;
        }
        var next = parseInt(document.getElementById("currentpos").value) + parseInt(lss);
        document.getElementById("currentpos").value = next;
        var rows = $('#grid').jqxGrid('getrows');
        var lcount = rows.length;

        if (next < lcount) {
            $('.leaveprev').attr("disabled", false);
            var ss = document.getElementById(next).value;
            var value = ss;
            $.ajax({
                url: "/Timesheet/ODNexttip?EmployeeCodey=" + value,
                Type: 'Get',
                dataType: 'json',
                success: function (response) {
                    if (response != null) {
                        //var dateString = response.lstartdate.substr(6);
                        //var currentTime = new Date(parseInt(dateString));
                        //var month = currentTime.getMonth() + 1;
                        //var day = currentTime.getDate();
                        //var year = currentTime.getFullYear();
                        //var sdate = day + "-" + month + "-" + year;
                        //var dateString1 = response.lenddate.substr(6);
                        //var currentTime1 = new Date(parseInt(dateString1));
                        //var month1 = currentTime1.getMonth() + 1;
                        //var day1 = currentTime1.getDate();
                        //var year1 = currentTime1.getFullYear();
                        //var edate = day1 + "-" + month1 + "-" + year1;
                        var text =
                            "<tr><td>EmployeeCode:</td><td>" + " " + " " + response.lEmployeeId
                            + "</td></tr> <tr><td> EmployeeName:</td><td>" + " " + " " + response.lEmployeeName
                            + "</td></tr> <tr><td> Branch/Dept:</td><td>" + " " + " " + response.lDeptbranch
                            + "</td></tr><tr><td>  Status:</td><td>" + " " + " " + response.lStatus + "</td></tr>"
                            + "</td></tr><tr><td> Applied Date:</td><td>" + " " + " " + response.lAppliedDate + "</td></tr>"
                            + "</td></tr><tr><td> Entry Time:</td><td>" + " " + " " + response.lentrytime + "</td></tr>"
                            + "</td></tr><tr><td> Exit Time:</td><td>" + " " + " " + response.lexittime + "</td></tr>"
                            + "</td></tr><tr><td> Request Date:</td><td>" + " " + " " + response.lReqFromDate + "</td></tr>"
                            + "</td></tr><tr><td> Reason Type:</td><td>" + " " + " " + response.lReason_Type + "</td></tr>"
                        //   + "</td></tr><tr><td> Description:</td><td>" + " " + " " + response.lReason_Desc + "</td></tr>";

                        document.getElementById("myTextArea").innerHTML = text;
                        // next button
                        if (next == lcount - 1) {
                            $('.leavenext').attr("disabled", true);
                        }
                    }

                },
            });
        }
        else {
            $('.leavenext').attr("disabled", true);
            //var text =
            //    "<tr><td>EmployeeId:</td><td>" + " " + " "
            //    + "</td></tr> <tr><td> EmployeeName:</td><td>" + " " + " "
            //    + "</td></tr> <tr><td> Designation:</td><td>" + " " + " "
            //    + "</td></tr><tr><td> Branch/Dept:</td><td>" + " " + " "  + "</td></tr>"
            //    + "</td></tr><tr><td> VisitFrom:</td><td>" + " " + " "  + "</td></tr>"
            //    + "</td></tr><tr><td> VisitTo:</td><td>" + " " + " "  + "</td></tr>"
            //    + "</td></tr><tr><td> StartDate:</td><td>" + " " + " "  + "</td></tr>"
            //    + "</td></tr><tr><td> EndDate:</td><td>" + " " + " "  + "</td></tr>"
            //    + "</td></tr><tr><td> Duration:</td><td>" + " " + " "  + "</td></tr>"
            //    + "</td></tr><tr><td> Purpose:</td><td>" + " " + " "  + "</td></tr>"
            //    + "</td></tr><tr><td> Status:</td><td>" + " " + " "  + "</td></tr>";

            //document.getElementById("myTextArea").innerHTML = text;
        }
    });


    $("#btnDenyApprovalpopup").click(function () {
        var rows = $("#grid").jqxGrid('selectedrowindexes');
        var lval = document.getElementById("currentpos").value;
        if (rows == '' || rows == null) {
            alert("Please select checkbox");
            // window.location.reload();
        }
        else {
            var selectedRecords = new Array();
            var names = '';
            var types = '';
            var ids = '';
            //for (var m = 0; m < rows.length; m++) {
            var row = $("#grid").jqxGrid('getrowdata', lval);
            selectedRecords[selectedRecords.length] = row;
            if (row == undefined) {
                window.alert("There is no Data. Please Click on Previous button to get Data.");
            }
            else {
                names = names + row.EmpId + ',';
                types = types + row.Code + ',';
                ids = ids + row.Id + ',';
                $('.leaveDeny').attr("disabled", true);
                //}

                $.ajax({
                    type: "Post",
                    url: "/Timesheet/Deny?EmployeeCodey=" + names + "&leaveTypes=" + types + "&LeaveIds=" + ids,
                    dataType: "Json",
                    success: function (response) {
                        if (response != null) {
                            window.location.reload();

                        }
                        else {
                            // alert("Something went wrong");
                        }
                    },
                });

            }
        }
    });



    $("#btncancelApprovalpopup").click(function () {
        var rows = $("#grid").jqxGrid('selectedrowindexes');
        var lval = document.getElementById("currentpos").value;
        if (rows == '' || rows == null) {
            alert("Please select checkbox");
            // window.location.reload();
        }
        else {
            var selectedRecords = new Array();
            var names = '';
            var types = '';
            var ids = '';
            //for (var m = 0; m < rows.length; m++) {
            var row = $("#grid").jqxGrid('getrowdata', lval);
            selectedRecords[selectedRecords.length] = row;
            if (row == undefined) {
                window.alert("There is no Data. Please Click on Previous button to get Data.");
            }
            else {
                names = names + row.EmpId + ',';
                types = types + row.Code + ',';
                ids = ids + row.Id + ',';
                $('.leavecancel').attr("disabled", true);
                //}

                $.ajax({
                    type: "Post",
                    url: "/Timesheet/Cancel?EmployeeCodey=" + names + "&LeaveIds=" + ids,
                    dataType: "Json",
                    success: function (response) {
                        if (response != null) {
                            window.location.reload();

                        }
                        else {
                            // alert("Something went wrong");
                        }
                    },
                });

            }
        }
    });
</script>

<script type="text/javascript">
    $("#btnApply").click(function () {
        debugger;
        //alert(1);
        var startdate = $("#SDate").val();
        var enddate = $("#EDate").val();
        var status = $("#Status").val();
        var source =
        {
            type: "Post",
            datatype: "json",
            datafields: [
                { name: 'available', type: 'bool' },
                { name: 'Id', type: 'int' },
                { name: 'EmpId', type: 'string' },
                { name: 'EmployeeName', type: 'string' },
                { name: 'Deptbranch', type: 'string' },
                { name: 'designation', type: 'string' },
                { name: 'ReqFromDate', type: 'date' },



                { name: 'AppliedDate', type: 'date' },

                { name: 'entrytime', type: 'string' },
                { name: 'exittime', type: 'string' },

                { name: 'Reason_Type', type: 'string' },
                { name: 'Status', type: 'string' },

            ],
            async: false,

            url: "/TimeSheet/TSApprovalViewsfilters?StartDate=" + startdate + "&EndDate=" + enddate + "&status=" + status,
            data: {
                featureClass: "P",
                style: "full",
                username: "jqwidgets"
            }
        };
        var cellsrenderer = function (row, columnfield, value, defaulthtml, columnproperties, rowdata) {
            if (value == "Pending") {
                return '<span style="margin: 4px; float: ' + columnproperties.cellsalign + '; color: #FFA500;">' + value + '</span>';
            }
            else if (value == "Forwarded") {
                return '<span style="margin: 4px; float: ' + columnproperties.cellsalign + '; color: #33b5e5;">' + value + '</span>';
            }
            else if (value == "Approved") {
                return '<span style="margin: 4px; float: ' + columnproperties.cellsalign + '; color: #00C851;">' + value + '</span>';
            }
            else {
                return '<span style="margin: 4px; float: ' + columnproperties.cellsalign + '; color: #ff4444;">' + value + '</span>';
            }
        }
        var dataAdapter = new $.jqx.dataAdapter(source,
            {
                formatData: function (data) {
                    data.ProductName = $("#searchField").val();
                    return data;
                }
            }
        );
        // initialize jqxGrid
        var editrowindex = -1;
        var delrowindex = -1;
        $("#grid").jqxGrid(
            {
                width: '99.5%',
                source: dataAdapter,
                theme: otherTheme,// for theme refernce go to Layout.cshtml
                autoheight: true,
                sortable: true,
                pageable: true,
                columnsResize: true,
                altRows: true,
                filterable: true,
                autoshowfiltericon: true,

                ready: function () {
                    $("#grid").jqxGrid('localizestrings', localizationObject);
                },
                updatefilterconditions: function (type, defaultconditions) {
                    switch (type) {
                        case 'stringfilter':
                            return stringcomparisonoperators;
                        case 'numericfilter':
                            return numericcomparisonoperators;
                        case 'datefilter':
                            return datecomparisonoperators;
                        case 'booleanfilter':
                            return booleancomparisonoperators;
                    }
                },
                updatefilterpanel: function (filtertypedropdown1, filtertypedropdown2, filteroperatordropdown, filterinputfield1, filterinputfield2,
                    filterbutton, clearbutton, columnfilter, filtertype, filterconditions) {
                    var index1 = 0;
                    var index2 = 0;
                    if (columnfilter != null) {
                        var filter1 = columnfilter.getfilterat(0);
                        var filter2 = columnfilter.getfilterat(1);
                        if (filter1) {
                            index1 = filterconditions.indexOf(filter1.comparisonoperator);
                            var value1 = filter1.filtervalue;
                            filterinputfield1.val(value1);
                        }
                        if (filter2) {
                            index2 = filterconditions.indexOf(filter2.comparisonoperator);
                            var value2 = filter2.filtervalue;
                            filterinputfield2.val(value2);
                        }
                    }
                    filtertypedropdown1.jqxDropDownList({ autoDropDownHeight: true, selectedIndex: index1 });
                    filtertypedropdown2.jqxDropDownList({ autoDropDownHeight: true, selectedIndex: index2 });
                },
                columns: [

                    { text: 'Action', datafield: 'available', exportable: false, sortable: false, columntype: 'checkbox', width: 50 },
                    { text: 'Id', groupable: true, datafield: 'Id', editable: false, width: 90, hidden: true, sortable: false },
                    { text: "Emp Code", datafield: "EmpId", width: 80, sortable: false, editable: false },
                    { text: "Employee Name", datafield: "EmployeeName", width: 127, sortable: false, editable: false },
                    { text: "Branch/Department", datafield: "Deptbranch", editable: false, width: 120, sortable: false },
                    { text: 'Designation', editable: false, datafield: 'designation', align: 'center', width: 90, sortable: false },
                    { text: 'Applied Date', editable: false, datafield: 'AppliedDate', align: 'center', width: 100, cellsformat: 'dd/MM/yyyy', sortable: false },
                    { text: 'Request Date', editable: false, datafield: 'ReqFromDate', align: 'center', width: 100, cellsformat: 'dd/MM/yyyy', sortable: false },
                    { text: 'Entry Time', datafield: 'entrytime', width: 60, cellsformat: 't', sortable: false, editable: false },
                    { text: 'Exit Time', datafield: 'exittime', width: 60, cellsformat: 't', sortable: false, editable: false },
                    { text: 'Reason Type', editable: false, datafield: 'Reason_Type', align: 'center', width: 170, sortable: false },
                    //{ text: 'Description', editable: false, datafield: 'Reason_Desc', align: 'center', width: 270, sortable: false },
                    { text: 'Status', editable: false, cellsrenderer: cellsrenderer, datafield: 'Status', align: 'center', width: 70, sortable: false },



                ],
                columngroups:
                    [
                        { text: 'Action', align: 'center', name: 'Actions', width: 120 },
                    ],
            });
    });
</script>
<script type='text/javascript'>
    $(function getholidays() {

        var active_dates = [];
        $.ajax({
            type: "GET",
            async: false,
            url: "/LeaveApply/GetDates",
            dataType: "Json",
            success: function (data) {
                datesArray = data;
                for (i = 0; i < datesArray.length; i++) {
                    var result = datesArray[i].replace("-", "/");
                    var result1 = result.replace("-", "/");
                    var strArray = result1.split("/");
                    var cdate = strArray[0] + "/" + parseInt(strArray[1]) + "/" + strArray[2]
                    active_dates.push(cdate);

                    if (i == datesArray.length - 1) {
                        //loadcal(active_dates);
                    }
                }

            }
        });
        $('.input-group.date').datepicker({
            format: "dd/mm/yyyy",
            autoclose: true,
            todayHighlight: true,
            beforeShowDay: function nonWorkingDays(date) {
                var day = date.getDay(), Sunday = 0, Monday = 1, Tuesday = 2, Wednesday = 3, Thursday = 4, Friday = 5, Saturday = 6;
                var week = 0 | date.getDate() / 7 //get the week
                var dd = date.getDate();
                var month = date.getMonth();
                if (dd < 10) {
                    dd = '0' + dd
                }

                if (month < 10) {
                    month = '0' + month
                }
                var sunweek = date.getDay();
                var year = date.getFullYear();

                if (dd == 14 && day == 6) {
                    return {
                        classes: 'secondClass'
                    };
                }
                if (dd == 28 && day == 6) {
                    return {
                        classes: 'secondClass'
                    };
                }
                //check if it's second week or fourth week
                else if (week == 1 || week == 3) {
                    if (dd == 7 && day == 6 || dd == 21 && day == 6) {
                        //check for satruday

                    }
                    else {
                        if (day == 6) {
                            return {
                                classes: 'secondClass'
                            };
                        }
                    }

                }
                //check for sunday
                if (day == 0) {
                    return {
                        classes: 'secondClass'
                    };

                }
                //check for holidays
                var d = date;
                var curr_date = d.getDate();
                var curr_month = d.getMonth() + 1; //Months are zero based
                if (curr_date < 10) {
                    curr_date = '0' + curr_date
                }
                var curr_year = d.getFullYear();
                var formattedDate = curr_date + "/" + curr_month + "/" + curr_year

                if ($.inArray(formattedDate, active_dates) != -1) {
                    return {
                        classes: 'activeClass'
                    };
                }
                return [true];
            }
        });


    });
</script>
<script>
    //To Date and From Date Validation
    function Dateevent2() {


        var fromdate = document.getElementById("SDate").value;
        var todate = document.getElementById("EDate").value;
        var date = moment(fromdate, "DD.MM.YYYY");

        var currentDate1 = moment(todate, "DD.MM.YYYY");
        var duration = moment.duration(date.diff(currentDate1));


        if (duration > 0) {

            alert("Please ensure that To Date is greater than or equal to From Date.");
            document.getElementById("EDate").focus();
            document.getElementById("EDate").value = '';
            return false;

        }
    }
    function Dateevent4() {
        var StartDate = document.getElementById('SDate').value;
        var EndDate = document.getElementById('EDate').value;
        var eDate = moment(EndDate, "DD.MM.YYYY");
        var sDate = moment(StartDate, "DD.MM.YYYY");
        if (StartDate != '' && EndDate != '' && sDate > eDate) {
            alert("Please ensure that To Date is greater than or equal to From Date.");
            document.getElementById('SDate').value = '';
            document.getElementById("SDate").focus();
            return false;
        }
    }
</script>



<script>
    document.getElementById("a1").className = "active";
</script>